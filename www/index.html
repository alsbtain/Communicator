<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, width=device-width">
        <title>Communicator</title>
		<style>
			html {
				padding: 0;
				margin: 0;
				height: 100%;
			}
			body {
				background-color: black;
				direction: rtl;
				padding 0;
				margin: 0;
				height: 100%;
				font: arial, sans-serif;
			}
		</style>
    </head>
    <body>
        <script type="text/javascript" src="cordova.js"></script>
		<script>
			function onDeviceReady() {

				networkinterface.getCarrierIPAddress(function (ip) {
					localIP = ip;
					alert(ip);
				});

				var wsserver = cordova.plugins.wsserver;
				wsserver.start(0, {
					// WebSocket Server handlers
					'onFailure' :  function(addr, port, reason) {
						console.log('Stopped listening on %s:%d. Reason: %s', addr, port, reason);
						alert("Stopped listening on " + addr + ":" + port + ". Reason: " + reason);
					},
					// WebSocket Connection handlers
					'onOpen' : function(conn) {
						/* conn: {
						 'uuid' : '8e176b14-a1af-70a7-3e3d-8b341977a16e',
						 'remoteAddr' : '192.168.1.10',
						 'acceptedProtocol' : 'my-protocol-v1',
						 'httpFields' : {...},
						 'resource' : '/?param1=value1&param2=value2'
						 } */
						console.log('A user connected from %s', conn.remoteAddr);
						alert("A user connected from " + conn.remoteAddr);
					},
					'onMessage' : function(conn, msg) {
						console.log(conn, msg);
						alert(conn + msg);
					},
					'onClose' : function(conn, code, reason, wasClean) {
						console.log('A user disconnected from %s', conn.remoteAddr);
						alert("A user disconnected from " + conn.remoteAddr);
					},
					// Other options
					// 'origins' : [ 'file://' ], // validates the 'Origin' HTTP Header.
					// 'protocols' : [ 'my-protocol-v1', 'my-protocol-v2' ], // validates the 'Sec-WebSocket-Protocol' HTTP Header.
					// 'tcpNoDelay' : true // disables Nagle's algorithm.
				}, function onStart(addr, port) {
					console.log('Listening on %s:%d', addr, port);
					alert("Listening on " + localIP + ":" + port);
					
				}, function onDidNotStart(reason) {
					console.log('Did not start. Reason: %s', reason);
					alert("Did not start. Reason: " + reason);
				});
			}
			
			document.addEventListener("deviceready", onDeviceReady, false);
		</script>
    </body>
</html>
